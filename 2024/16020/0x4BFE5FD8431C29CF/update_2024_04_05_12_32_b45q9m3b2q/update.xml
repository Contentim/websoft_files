<?xml version="1.0" encoding="utf-8"?>
<data>
	<basic>
		<id>b45q9m3b2q</id>
		<create_date>2024-04-05T12:32:34+00:00</create_date>
		<server_version>2023.2.853 (2024-03-02)</server_version>
	</basic>
	<custom_web_templates>
		<custom_web_template>
			<id>0x4BFE5FD8431C29CF</id>
			<code>rolf_finall_common_report</code>
			<name>Отчет по результатам обратной связи 360 градусов - Отчет по результатам оценки (общая статистика)</name>
			<category>websoft</category>
			<exec_code>
				<code_text>&lt;%&#10;// -----------------------------------------------------------------------------------------------------------------------------&#10;// автор:&#9;RH&#10;// создан:&#9;30.05.2010&#10;// изменен:&#9;&#10;// -------------------------------------------------Предупреждение--------------------------------------------------------------&#10;// используется шаблонами документов&#10;// &#9;&#9; rolf_competence_appraisal_common_report - Аналитические данные по оценке компетенций&#10;// ------------------------------------------------Параметры шаблона------------------------------------------------------------&#10;// &lt;нет&gt;&#10;// ----------------------------------------------Глобальные переменные----------------------------------------------------------&#10;// &lt;нет&gt;&#10;// ---------------------------------------------------Константы-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#10;// ******************ОСНОВНАЯ ОБЛАСТЬ*************************&#9;&#9;&#10;&#9;// выбранные процедуры оценки&#10;&#9;AssessmentAppraises = Trim( Request.Form.assessment_app_ids ).split(",");&#10;&#9;for (_ass_id in AssessmentAppraises)&#10;&#9;{&#10;&#9;&#9;RowNum = 0;&#10;&#10;&#9;&#9;_ass_name = OpenDoc(UrlFromDocID(Int(_ass_id))).TopElem.name;&#10;&#10;&#9;&#9;Plans = XQuery("for $obj in assessment_plans where $obj/assessment_appraise_id = " + _ass_id + &#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;" and $obj/person_id = " + Request.Form.coll_ids + " order by $obj/person_fullname return $obj");&#10;&#9;&#9;_plan = ArrayOptFirstElem(Plans);&#10;&#9;&#9;if (_plan == undefined)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;html_TEXT += "&lt;center&gt;&lt;font&gt;&lt;color='red'&gt;Отсутствует план оценки сотрудника для процедуры " + _ass_name + "&lt;/color&gt;&lt;/font&gt;&lt;center&gt;";&#10;&#9;&#9;&#9;continue;&#10;&#9;&#9;}&#10;&#9;&#9;// план оценки сотрудника&#10;&#9;&#9;try&#10;&#9;&#9;{&#10;&#9;&#9;&#9;plan_id = _plan.id;&#10;&#9;&#9;&#9;planDoc = OpenDoc(UrlFromDocID(plan_id)).TopElem;&#10;&#9;&#9;}&#10;&#9;&#9;catch(err)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;alert("ОШИБКА: невозможно получить карточку плана оценки сотрудника. " + err);&#10;&#9;&#9;&#9;continue;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;// карточка оцениваемого сотрудника&#10;&#9;&#9;collDoc = OpenDoc(UrlFromDocID(planDoc.person_id)).TopElem;&#10;&#9;&#9;&#10;&#9;&#9;// процедура оценки&#10;&#9;&#9;AssessmentAppraise = OpenDoc(UrlFromDocID(planDoc.assessment_appraise_id)).TopElem;&#10;&#9;&#9;&#10;&#9;&#9;RowNum = 0;&#10;&#9;&#9;try&#10;&#9;&#9;{&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;_pa = ArrayOptFirstElem(XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + &#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;" and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' return $obj"));&#10;&#9;&#9;&#9;if (_pa == undefined)&#10;&#9;&#9;&#9;&#9;throw 'No pa exists';&#10;&#9;&#9;&#9;_profile_id = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competence_profile_id;&#10;&#9;&#9;&#9;Profile = OpenDoc(UrlFromDocID(Int(_profile_id))).TopElem;&#10;&#9;&#9;}&#10;&#9;&#9;catch(err)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;alert("ОШИБКА: Невозможно получить профиль компетенций. " + err);&#10;&#9;&#9;&#9;Profile = null;&#10;&#9;&#9;}&#10;&#9;&#9;&#10;//Отчет по результатам оценки&#10;&#10;&#9;&#9;_strComp="";&#10;&#9;&#9;_strIndi=Array();&#10;&#9;&#9;_coll="";&#10;&#9;&#9;_staff="";&#10;&#9;&#9;_expert="";&#10;&#9;&#9;PasManager = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'manager' return $obj");&#10;&#9;&#9;PasStaff = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'staff' return $obj");&#10;&#9;&#9;PasColl = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'coll' return $obj");&#10;&#9;&#9;PasExpert = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'expert' return $obj");&#10;&#9;&#9;_str = "&#10;&lt;br&gt;&#10;&lt;p align='left'&gt;&lt;b&gt;Отчет по результатам оценки(общая статистика)&lt;/b&gt;&lt;/p&gt;&#10;&lt;table x:str border=0 cellpadding=0 cellspacing=0 style='border-collapse:collapse'&gt;&#10;&#9;&lt;tr style='mso-height-source:userset;mso-yfti-irow:" + RowNum + "'&gt;" + "&#10;&#9;&lt;td class=xl35_finall width='100' &gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;td class=xl37 &gt;Выгружаемое значение&lt;/td&gt;&#10;&#9;&lt;td class=xl37 &gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;td class=xl36_finall  width='100'&gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;td class=xl37 &gt;Рассчитываемое значение&lt;/td&gt;&#10;&#9;&lt;/tr&gt;&#10;&lt;/table&gt;&#10;&lt;div&gt;&lt;/div&gt;&#10;&lt;div style='overflow: auto;'&gt;&#10;&lt;table x:str border=0 cellpadding=0 cellspacing=0 style='border-collapse:collapse'&gt;&#10;&#9;&lt;tr style='mso-height-source:userset;mso-yfti-irow:" + RowNum + "'&gt;" + "&#10;&#9;&lt;td class=xl37 &gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;/tr&gt;&#10;&#9;&lt;tr height=81 style='height:60.75pt;mso-yfti-firstrow:yes'&gt;&#10;&#9;&lt;td class=xl31&gt;Компетенция/индикатор&lt;/td&gt;&#10;&#9;&lt;td class=xl31&gt;Самооценка&lt;/td&gt;&#10;&#9;&lt;td class=xl31&gt;Руководитель("+ArrayOptFirstElem(PasManager).expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i=1;&#10;&#9;&#9;for(_pas in PasStaff)&#10;&#9;&#9;{&#10;&#9;&#9;_staff+="&#10;&#9;&lt;td class=xl31&gt;Подчиненный"+i+"("+_pas.expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i++;&#10;&#9;&#9;}&#10;&#9;&#9;_str+=_staff;&#10;&#9;&#9;_str+="&#10;&#9;&lt;td class=xl31&gt;Среднее по подчиненным&lt;/td&gt;";&#10;&#9;&#9;i=1;&#10;&#9;&#9;for(_pas in PasColl)&#10;&#9;&#9;{&#10;&#9;&#9;_coll+="&#10;&#9;&lt;td class=xl31&gt;Коллега"+i+"("+_pas.expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i++;&#10;&#9;&#9;}&#10;&#9;&#9;_str+=_coll;&#10;&#9;&#9;_str+="&#10;&#9;&lt;td class=xl31&gt;Среднее по коллегам&lt;/td&gt;";&#10;&#9;&#9;i=1;&#10;&#9;&#9;for(_pas in PasExpert)&#10;&#9;&#9;{&#10;&#9;&#9;_expert+="&#10;&#9;&lt;td class=xl31&gt;Экперт"+i+"("+_pas.expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i++;&#10;&#9;&#9;}&#10;&#9;&#9;_str+=_expert;&#10;&#9;&#9;_str+="&#10;&#9;&lt;td class=xl31&gt;Среднее по экспертам&lt;/td&gt;&#10;&#9;&lt;td class=xl31&gt;Стандарт по профилю&lt;/td&gt;&#10;&#9;&lt;/tr&gt;&#10;&#9;&lt;tr&gt;&#10;";&#10;&#9;&#9;// цикл по компетенциям&#10;&#9;&#9;for (_comp in Profile.competences)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;// компетенция&#10;&#9;&#9;&#9;CompetenceName = OpenDoc(UrlFromDocID(_comp.competence_id)).TopElem.name;&#10;&#9;&#9;&#9;_strComp="&#10; &lt;tr style='mso-height-source:userset;'&gt;&#10;  &lt;td class=xl30 style='font-weight: 600' &gt;" + CompetenceName + "&lt;/td&gt;";&#10;&#9;&#9;&#9;// индикаторы&#10;&#9;&#9;&#9;_strSelf=null;&#10;&#9;&#9;&#9;_strManager=null;&#10;&#9;&#9;&#9;_strColl=null;&#10;&#9;&#9;&#9;_strCollAll=null;&#10;&#9;&#9;&#9;_strStaff=null;&#10;&#9;&#9;&#9;_strStaffAll=null;&#10;&#9;&#9;&#9;_strExpert=null;&#10;&#9;&#9;&#9;_strExpertAll=null;&#10;&#9;&#9;&#9;_rowIndi=0;&#10;&#9;&#9;// цикл по индикаторам&#10;&#9;&#9;for (_indi in _comp.indicators)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;IndiName = OpenDoc(UrlFromDocID(_indi.indicator_id)).TopElem.name;&#10;&#9;&#9;&#9;_strIndi[_rowIndi]="&#10; &lt;tr style='mso-height-source:userset;'&gt;&#10;  &lt;td class=xl33_finall &gt; - " + IndiName + "&lt;/td&gt;";&#10;&#10;&#9;&#9;// самооценка&#10;&#9;&#9;&#9;SelfMarkComp = null;&#10;&#9;&#9;&#9;SelfMarkIndi = null;&#10;&#9;&#9;&#9;Pas = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'self' return $obj");&#10;&#9;&#9;&#9;_pa = ArrayOptFirstElem(Pas);&#10;&#9;&#9;&#9;if (_pa != undefined)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;Comp =OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;if (Comp!= undefined) {&#10;&#9;&#9;&#9;&#9;&#9;SelfMarkComp = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;if (Indi!= undefined) {&#10;&#9;&#9;&#9;&#9;&#9;SelfMarkIndi = GetMarkFromCompetence(Indi, "mark");&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (SelfMarkComp!=null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;SelfMarkComp = Real(StrRealFixed(SelfMarkComp, 2));&#10;&#9;&#9;&#9;}&#9;&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;SelfMarkComp="";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (SelfMarkIndi!= null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;SelfMarkIndi = Real(StrRealFixed(SelfMarkIndi, 2));&#10;&#9;&#9;&#9;}&#9;&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;&#9;SelfMarkIndi = "";&#10;&#10;&#9;&#9;&#9;if(_strSelf==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;_strSelf="&#10;&#9;&lt;td class=xl34_finall &gt;" + SelfMarkComp + "&lt;/td&gt;";&#10;&#9;&#9;&#9;_strComp+=_strSelf&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#10;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + SelfMarkIndi + "&lt;/td&gt;";&#10;&#10;&#9;&#9;// средняя оценка руководителя&#10;&#9;&#9;&#9;ManagerMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;ManagerMarkComp= Real(0.0);&#10;&#9;&#9;&#9;ManagerMarkCountIndi=0;&#10;&#9;&#9;&#9;ManagerMarkCountComp=0;&#10;&#9;&#9;&#9;for (_pa in PasManager)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined)&#10;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;Comp =OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_mmark = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_mmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkComp += _mmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_mmark = GetMarkFromCompetence(Indi, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_mmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkIndi += _mmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (ManagerMarkCountComp &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkComp = ManagerMarkComp / ManagerMarkCountComp;&#10;&#9;&#9;&#9;&#9;ManagerMarkComp = Real(StrRealFixed(ManagerMarkComp, 2));&#10;&#9;&#9;&#9;} else if(ManagerMarkCountComp == 0){&#10;&#9;&#9;&#9;&#9;ManagerMarkComp = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkComp="";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;if (ManagerMarkCountIndi &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = ManagerMarkIndi / ManagerMarkCountIndi;&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = Real(StrRealFixed(ManagerMarkIndi, 2));&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (ManagerMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = 0;&#10;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;if(_strManager==null)&#10;&#9;&#9;&#9;{&#10;&#10;&#9;&#9;&#9;_strManager="&#10;&#9;&lt;td class=xl34_finall &gt;" + ManagerMarkComp + "&lt;/td&gt;";&#10;&#9;&#9;&#9;_strComp+=_strManager;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + ManagerMarkIndi + "&lt;/td&gt;";&#10;&#10;&#9;&#9;&#9;// средняя оценка подчиненных&#10;&#9;&#9;&#9;StaffMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;StaffMarkComp = Real(0.0);&#10;&#9;&#9;&#9;StaffMarkCountIndi = 0;&#10;&#9;&#9;&#9;StaffMarkCountComp = 0;&#10;&#9;&#9;&#9;for (_pa in PasStaff)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;Comp = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_smark = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_smark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkComp += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_smark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkComp += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strStaff+="&#10;&#9;&lt;td class=xl34_finall &gt;" + _smark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_smark = GetMarkFromCompetence(Indi, "mark");&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if(_smark == null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_smark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall DEVELOPER&gt;" + _smark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_smark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkIndi += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_smark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkIndi += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (StaffMarkCountComp &gt; 0) &#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkComp = StaffMarkComp / StaffMarkCountComp;&#10;&#9;&#9;&#9;&#9;StaffMarkComp = Real(StrRealFixed(StaffMarkComp, 2));&#10;&#9;&#9;&#9;} else if (StaffMarkCountComp == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkComp = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkComp = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;if (_strStaffAll==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;_strStaffAll=(_strStaff!= null) ? _strStaff : '';&#10;&#9;&#9;&#9;&#9;StaffMarkComp=(StaffMarkComp!= 0) ? StaffMarkComp : 0;&#10;&#9;&#9;&#9;&#9;_strComp+=_strStaffAll+"&#10;&#9;&lt;td class=xl34_finall &gt;" + StaffMarkComp+ "&lt;/td&gt;";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (StaffMarkCountIndi &gt; 0) &#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = StaffMarkIndi / StaffMarkCountIndi;&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = Real(StrRealFixed(StaffMarkIndi, 2));&#10;&#9;&#9;&#9;} else if (StaffMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl34_finall RESULT&gt;" + StaffMarkIndi + " &lt;/td&gt;";&#10;&#10;&#9;&#9;// средняя оценка коллег&#10;&#9;&#9;&#9;CollMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;CollMarkComp = Real(0.0);&#10;&#9;&#9;&#9;CollMarkCountIndi=0;&#10;&#9;&#9;&#9;CollMarkCountComp=0;&#10;&#9;&#9;&#9;for (_pa in PasColl)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;Comp = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = (_getMark) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_cmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkComp += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkComp += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strColl+="&#10;&#9;&lt;td class=xl34_finall &gt;" + _cmark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = GetMarkFromCompetence(Indi, "mark");&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_cmark == null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + _cmark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_cmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkIndi += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkIndi += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (CollMarkCountComp &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkComp = CollMarkComp / CollMarkCountComp;&#10;&#9;&#9;&#9;&#9;CollMarkComp = Real(StrRealFixed(CollMarkComp, 2));&#10;&#9;&#9;&#9;} else if (CollMarkCountComp == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkComp = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkComp = "";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (_strCollAll==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;_strCollAll=(_strColl!= null) ? _strColl : '';&#10;&#9;&#9;&#9;&#9;CollMarkComp=(CollMarkComp!= 0) ? CollMarkComp : 0;&#10;&#9;&#9;&#9;&#9;_strComp+=_strCollAll+"&#10;&#9;&lt;td class=xl34_finall &gt;" + CollMarkComp+ "&lt;/td&gt;";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (CollMarkCountIndi &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkIndi = CollMarkIndi / CollMarkCountIndi;&#10;&#9;&#9;&#9;&#9;CollMarkIndi = Real(StrRealFixed(CollMarkIndi, 2));&#10;&#9;&#9;&#9;} else if (CollMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkIndi = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl34_finall &gt;" + CollMarkIndi + "&lt;/td&gt;";&#10;&#10;&#9;&#9;&#9;// средняя оценка экспертов&#10;&#9;&#9;&#9;ExpertMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;ExpertMarkComp=Real(0.0);&#10;&#9;&#9;&#9;ExpertMarkCountIndi=0;&#10;&#9;&#9;&#9;ExpertMarkCountComp=0;&#10;&#9;&#9;&#9;for (_pa in PasExpert)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;Comp = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_emark = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#9;&#9;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_emark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkComp += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_emark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkComp += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strExpert+="&#10;&#9;&lt;td class=xl34_finall &gt;" + _emark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_emark = GetMarkFromCompetence(Indi, "mark");&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if(_emark == null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_emark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + _emark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_emark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkIndi += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_emark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkIndi += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;if (ExpertMarkCountComp &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkComp = ExpertMarkComp / ExpertMarkCountComp;&#10;&#9;&#9;&#9;&#9;ExpertMarkComp = Real(StrRealFixed(ExpertMarkComp, 2));&#10;&#9;&#9;&#9;} else if (ExpertMarkCountComp == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkCom = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkCom = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;if (_strExpertAll==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;_strExpertAll=(_strExpert!= null) ? _strExpert : '';&#10;&#9;&#9;&#9;&#9;ExpertMarkComp=(ExpertMarkComp!= 0) ? ExpertMarkComp : 0;&#10;&#9;&#9;&#9;&#9;_strComp+=_strExpertAll+"&#10;&#9;&lt;td class=xl34_finall &gt;" + ExpertMarkComp+ "&lt;/td&gt;&#10;";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (ExpertMarkCountIndi &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = ExpertMarkIndi / ExpertMarkCountIndi;&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = Real(StrRealFixed(ExpertMarkIndi, 2));&#10;&#9;&#9;&#9;} else if (ExpertMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl34_finall &gt;" + ExpertMarkIndi + "&lt;/td&gt;&#10;";&#10;&#9;&#9;&#9;// плановая оценка индикатора&#10;&#9;&#9;&#9;PlanMarkIndi = GetMarkFromCompetence(_indi, "plan");&#9;&#9;&#9;&#10;&#9;&#9;&#9;PlanMarkIndi = (PlanMarkIndi!= null) ? PlanMarkIndi : 0;&#9;&#10;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + PlanMarkIndi + "&lt;/td&gt;&#10;&#9;&lt;/tr&gt;";&#10;&#9;&#9;_rowIndi++;&#10;&#9;&#9;}//for_indi&#10;&#9;&#9;// плановая оценка компетенции&#10;&#9;&#9;PlanMarkComp = GetMarkFromCompetence(_comp, "plan");&#9;&#9;&#9;&#10;&#9;&#9;PlanMarkComp = (PlanMarkComp!= null) ? PlanMarkComp : 0;&#10;&#9;&#9;_strComp +="&#10;&#9;&lt;td class=xl32_finall &gt;" + PlanMarkComp + "&lt;/td&gt;&#10;&#9;&lt;/tr&gt;";&#9;&#10;&#9;&#9;_str+=_strComp;&#10;&#9;&#9;for(i=0;i&lt;ArrayCount(_comp.indicators);i++)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;_str+=_strIndi[i];&#9;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;}//for_comp&#10;&#9;&#9;_str+="&#10;&lt;/table&gt;&lt;/div&gt;";&#10;&#10;&#9;&#9;html_TEXT += _str;&#10;&#9;&#9;Session.excel_html += _str;&#10;&#9;} // for (_ass in AssessmentAppraises)&#10;&#10;%&gt;</code_text>
			</exec_code>
			<html>&lt;%&#10;// -----------------------------------------------------------------------------------------------------------------------------&#10;// автор:&#9;RH&#10;// создан:&#9;30.05.2010&#10;// изменен:&#9;&#10;// -------------------------------------------------Предупреждение--------------------------------------------------------------&#10;// используется шаблонами документов&#10;// &#9;&#9; rolf_competence_appraisal_common_report - Аналитические данные по оценке компетенций&#10;// ------------------------------------------------Параметры шаблона------------------------------------------------------------&#10;// &lt;нет&gt;&#10;// ----------------------------------------------Глобальные переменные----------------------------------------------------------&#10;// &lt;нет&gt;&#10;// ---------------------------------------------------Константы-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#10;// ******************ОСНОВНАЯ ОБЛАСТЬ*************************&#9;&#9;&#10;&#9;// выбранные процедуры оценки&#10;&#9;AssessmentAppraises = Trim( Request.Form.assessment_app_ids ).split(",");&#10;&#9;for (_ass_id in AssessmentAppraises)&#10;&#9;{&#10;&#9;&#9;RowNum = 0;&#10;&#10;&#9;&#9;_ass_name = OpenDoc(UrlFromDocID(Int(_ass_id))).TopElem.name;&#10;&#10;&#9;&#9;Plans = XQuery("for $obj in assessment_plans where $obj/assessment_appraise_id = " + _ass_id + &#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;" and $obj/person_id = " + Request.Form.coll_ids + " order by $obj/person_fullname return $obj");&#10;&#9;&#9;_plan = ArrayOptFirstElem(Plans);&#10;&#9;&#9;if (_plan == undefined)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;html_TEXT += "&lt;center&gt;&lt;font&gt;&lt;color='red'&gt;Отсутствует план оценки сотрудника для процедуры " + _ass_name + "&lt;/color&gt;&lt;/font&gt;&lt;center&gt;";&#10;&#9;&#9;&#9;continue;&#10;&#9;&#9;}&#10;&#9;&#9;// план оценки сотрудника&#10;&#9;&#9;try&#10;&#9;&#9;{&#10;&#9;&#9;&#9;plan_id = _plan.id;&#10;&#9;&#9;&#9;planDoc = OpenDoc(UrlFromDocID(plan_id)).TopElem;&#10;&#9;&#9;}&#10;&#9;&#9;catch(err)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;alert("ОШИБКА: невозможно получить карточку плана оценки сотрудника. " + err);&#10;&#9;&#9;&#9;continue;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;// карточка оцениваемого сотрудника&#10;&#9;&#9;collDoc = OpenDoc(UrlFromDocID(planDoc.person_id)).TopElem;&#10;&#9;&#9;&#10;&#9;&#9;// процедура оценки&#10;&#9;&#9;AssessmentAppraise = OpenDoc(UrlFromDocID(planDoc.assessment_appraise_id)).TopElem;&#10;&#9;&#9;&#10;&#9;&#9;RowNum = 0;&#10;&#9;&#9;try&#10;&#9;&#9;{&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;_pa = ArrayOptFirstElem(XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + &#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;" and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' return $obj"));&#10;&#9;&#9;&#9;if (_pa == undefined)&#10;&#9;&#9;&#9;&#9;throw 'No pa exists';&#10;&#9;&#9;&#9;_profile_id = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competence_profile_id;&#10;&#9;&#9;&#9;Profile = OpenDoc(UrlFromDocID(Int(_profile_id))).TopElem;&#10;&#9;&#9;}&#10;&#9;&#9;catch(err)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;alert("ОШИБКА: Невозможно получить профиль компетенций. " + err);&#10;&#9;&#9;&#9;Profile = null;&#10;&#9;&#9;}&#10;&#9;&#9;&#10;//Отчет по результатам оценки&#10;&#10;&#9;&#9;_strComp="";&#10;&#9;&#9;_strIndi=Array();&#10;&#9;&#9;_coll="";&#10;&#9;&#9;_staff="";&#10;&#9;&#9;_expert="";&#10;&#9;&#9;PasManager = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'manager' return $obj");&#10;&#9;&#9;PasStaff = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'staff' return $obj");&#10;&#9;&#9;PasColl = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'coll' return $obj");&#10;&#9;&#9;PasExpert = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'expert' return $obj");&#10;&#9;&#9;_str = "&#10;&lt;br&gt;&#10;&lt;p align='left'&gt;&lt;b&gt;Отчет по результатам оценки(общая статистика)&lt;/b&gt;&lt;/p&gt;&#10;&lt;table x:str border=0 cellpadding=0 cellspacing=0 style='border-collapse:collapse'&gt;&#10;&#9;&lt;tr style='mso-height-source:userset;mso-yfti-irow:" + RowNum + "'&gt;" + "&#10;&#9;&lt;td class=xl35_finall width='100' &gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;td class=xl37 &gt;Выгружаемое значение&lt;/td&gt;&#10;&#9;&lt;td class=xl37 &gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;td class=xl36_finall  width='100'&gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;td class=xl37 &gt;Рассчитываемое значение&lt;/td&gt;&#10;&#9;&lt;/tr&gt;&#10;&lt;/table&gt;&#10;&lt;div&gt;&lt;/div&gt;&#10;&lt;div style='overflow: auto;'&gt;&#10;&lt;table x:str border=0 cellpadding=0 cellspacing=0 style='border-collapse:collapse'&gt;&#10;&#9;&lt;tr style='mso-height-source:userset;mso-yfti-irow:" + RowNum + "'&gt;" + "&#10;&#9;&lt;td class=xl37 &gt;&amp;nbsp&lt;/td&gt;&#10;&#9;&lt;/tr&gt;&#10;&#9;&lt;tr height=81 style='height:60.75pt;mso-yfti-firstrow:yes'&gt;&#10;&#9;&lt;td class=xl31&gt;Компетенция/индикатор&lt;/td&gt;&#10;&#9;&lt;td class=xl31&gt;Самооценка&lt;/td&gt;&#10;&#9;&lt;td class=xl31&gt;Руководитель("+ArrayOptFirstElem(PasManager).expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i=1;&#10;&#9;&#9;for(_pas in PasStaff)&#10;&#9;&#9;{&#10;&#9;&#9;_staff+="&#10;&#9;&lt;td class=xl31&gt;Подчиненный"+i+"("+_pas.expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i++;&#10;&#9;&#9;}&#10;&#9;&#9;_str+=_staff;&#10;&#9;&#9;_str+="&#10;&#9;&lt;td class=xl31&gt;Среднее по подчиненным&lt;/td&gt;";&#10;&#9;&#9;i=1;&#10;&#9;&#9;for(_pas in PasColl)&#10;&#9;&#9;{&#10;&#9;&#9;_coll+="&#10;&#9;&lt;td class=xl31&gt;Коллега"+i+"("+_pas.expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i++;&#10;&#9;&#9;}&#10;&#9;&#9;_str+=_coll;&#10;&#9;&#9;_str+="&#10;&#9;&lt;td class=xl31&gt;Среднее по коллегам&lt;/td&gt;";&#10;&#9;&#9;i=1;&#10;&#9;&#9;for(_pas in PasExpert)&#10;&#9;&#9;{&#10;&#9;&#9;_expert+="&#10;&#9;&lt;td class=xl31&gt;Экперт"+i+"("+_pas.expert_person_fullname+")&lt;/td&gt;";&#10;&#9;&#9;i++;&#10;&#9;&#9;}&#10;&#9;&#9;_str+=_expert;&#10;&#9;&#9;_str+="&#10;&#9;&lt;td class=xl31&gt;Среднее по экспертам&lt;/td&gt;&#10;&#9;&lt;td class=xl31&gt;Стандарт по профилю&lt;/td&gt;&#10;&#9;&lt;/tr&gt;&#10;&#9;&lt;tr&gt;&#10;";&#10;&#9;&#9;// цикл по компетенциям&#10;&#9;&#9;for (_comp in Profile.competences)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;// компетенция&#10;&#9;&#9;&#9;CompetenceName = OpenDoc(UrlFromDocID(_comp.competence_id)).TopElem.name;&#10;&#9;&#9;&#9;_strComp="&#10; &lt;tr style='mso-height-source:userset;'&gt;&#10;  &lt;td class=xl30 style='font-weight: 600' &gt;" + CompetenceName + "&lt;/td&gt;";&#10;&#9;&#9;&#9;// индикаторы&#10;&#9;&#9;&#9;_strSelf=null;&#10;&#9;&#9;&#9;_strManager=null;&#10;&#9;&#9;&#9;_strColl=null;&#10;&#9;&#9;&#9;_strCollAll=null;&#10;&#9;&#9;&#9;_strStaff=null;&#10;&#9;&#9;&#9;_strStaffAll=null;&#10;&#9;&#9;&#9;_strExpert=null;&#10;&#9;&#9;&#9;_strExpertAll=null;&#10;&#9;&#9;&#9;_rowIndi=0;&#10;&#9;&#9;// цикл по индикаторам&#10;&#9;&#9;for (_indi in _comp.indicators)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;IndiName = OpenDoc(UrlFromDocID(_indi.indicator_id)).TopElem.name;&#10;&#9;&#9;&#9;_strIndi[_rowIndi]="&#10; &lt;tr style='mso-height-source:userset;'&gt;&#10;  &lt;td class=xl33_finall &gt; - " + IndiName + "&lt;/td&gt;";&#10;&#10;&#9;&#9;// самооценка&#10;&#9;&#9;&#9;SelfMarkComp = null;&#10;&#9;&#9;&#9;SelfMarkIndi = null;&#10;&#9;&#9;&#9;Pas = XQuery("for $obj in pas where $obj/assessment_appraise_id = " + planDoc.assessment_appraise_id + " and $obj/person_id = " + planDoc.person_id + " and $obj/assessment_appraise_type = 'competence_appraisal' and $obj/status = 'self' return $obj");&#10;&#9;&#9;&#9;_pa = ArrayOptFirstElem(Pas);&#10;&#9;&#9;&#9;if (_pa != undefined)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;Comp =OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;if (Comp!= undefined) {&#10;&#9;&#9;&#9;&#9;&#9;SelfMarkComp = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;if (Indi!= undefined) {&#10;&#9;&#9;&#9;&#9;&#9;SelfMarkIndi = GetMarkFromCompetence(Indi, "mark");&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (SelfMarkComp!=null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;SelfMarkComp = Real(StrRealFixed(SelfMarkComp, 2));&#10;&#9;&#9;&#9;}&#9;&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;SelfMarkComp="";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (SelfMarkIndi!= null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;SelfMarkIndi = Real(StrRealFixed(SelfMarkIndi, 2));&#10;&#9;&#9;&#9;}&#9;&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;&#9;SelfMarkIndi = "";&#10;&#10;&#9;&#9;&#9;if(_strSelf==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;_strSelf="&#10;&#9;&lt;td class=xl34_finall &gt;" + SelfMarkComp + "&lt;/td&gt;";&#10;&#9;&#9;&#9;_strComp+=_strSelf&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#10;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + SelfMarkIndi + "&lt;/td&gt;";&#10;&#10;&#9;&#9;// средняя оценка руководителя&#10;&#9;&#9;&#9;ManagerMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;ManagerMarkComp= Real(0.0);&#10;&#9;&#9;&#9;ManagerMarkCountIndi=0;&#10;&#9;&#9;&#9;ManagerMarkCountComp=0;&#10;&#9;&#9;&#9;for (_pa in PasManager)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined)&#10;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;Comp =OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_mmark = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_mmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkComp += _mmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_mmark = GetMarkFromCompetence(Indi, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_mmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkIndi += _mmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ManagerMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (ManagerMarkCountComp &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkComp = ManagerMarkComp / ManagerMarkCountComp;&#10;&#9;&#9;&#9;&#9;ManagerMarkComp = Real(StrRealFixed(ManagerMarkComp, 2));&#10;&#9;&#9;&#9;} else if(ManagerMarkCountComp == 0){&#10;&#9;&#9;&#9;&#9;ManagerMarkComp = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkComp="";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;if (ManagerMarkCountIndi &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = ManagerMarkIndi / ManagerMarkCountIndi;&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = Real(StrRealFixed(ManagerMarkIndi, 2));&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else if (ManagerMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = 0;&#10;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;ManagerMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;if(_strManager==null)&#10;&#9;&#9;&#9;{&#10;&#10;&#9;&#9;&#9;_strManager="&#10;&#9;&lt;td class=xl34_finall &gt;" + ManagerMarkComp + "&lt;/td&gt;";&#10;&#9;&#9;&#9;_strComp+=_strManager;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + ManagerMarkIndi + "&lt;/td&gt;";&#10;&#10;&#9;&#9;&#9;// средняя оценка подчиненных&#10;&#9;&#9;&#9;StaffMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;StaffMarkComp = Real(0.0);&#10;&#9;&#9;&#9;StaffMarkCountIndi = 0;&#10;&#9;&#9;&#9;StaffMarkCountComp = 0;&#10;&#9;&#9;&#9;for (_pa in PasStaff)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;Comp = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_smark = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_smark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkComp += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_smark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkComp += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strStaff+="&#10;&#9;&lt;td class=xl34_finall &gt;" + _smark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_smark = GetMarkFromCompetence(Indi, "mark");&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if(_smark == null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_smark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall DEVELOPER&gt;" + _smark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_smark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkIndi += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_smark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkIndi += _smark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;StaffMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (StaffMarkCountComp &gt; 0) &#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkComp = StaffMarkComp / StaffMarkCountComp;&#10;&#9;&#9;&#9;&#9;StaffMarkComp = Real(StrRealFixed(StaffMarkComp, 2));&#10;&#9;&#9;&#9;} else if (StaffMarkCountComp == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkComp = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkComp = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;if (_strStaffAll==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;_strStaffAll=(_strStaff!= null) ? _strStaff : '';&#10;&#9;&#9;&#9;&#9;StaffMarkComp=(StaffMarkComp!= 0) ? StaffMarkComp : 0;&#10;&#9;&#9;&#9;&#9;_strComp+=_strStaffAll+"&#10;&#9;&lt;td class=xl34_finall &gt;" + StaffMarkComp+ "&lt;/td&gt;";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (StaffMarkCountIndi &gt; 0) &#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = StaffMarkIndi / StaffMarkCountIndi;&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = Real(StrRealFixed(StaffMarkIndi, 2));&#10;&#9;&#9;&#9;} else if (StaffMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;StaffMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl34_finall RESULT&gt;" + StaffMarkIndi + " &lt;/td&gt;";&#10;&#10;&#9;&#9;// средняя оценка коллег&#10;&#9;&#9;&#9;CollMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;CollMarkComp = Real(0.0);&#10;&#9;&#9;&#9;CollMarkCountIndi=0;&#10;&#9;&#9;&#9;CollMarkCountComp=0;&#10;&#9;&#9;&#9;for (_pa in PasColl)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;Comp = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = (_getMark) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_cmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkComp += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkComp += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strColl+="&#10;&#9;&lt;td class=xl34_finall &gt;" + _cmark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = GetMarkFromCompetence(Indi, "mark");&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_cmark == null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + _cmark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_cmark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkIndi += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_cmark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkIndi += _cmark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;CollMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (CollMarkCountComp &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkComp = CollMarkComp / CollMarkCountComp;&#10;&#9;&#9;&#9;&#9;CollMarkComp = Real(StrRealFixed(CollMarkComp, 2));&#10;&#9;&#9;&#9;} else if (CollMarkCountComp == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkComp = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkComp = "";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (_strCollAll==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;_strCollAll=(_strColl!= null) ? _strColl : '';&#10;&#9;&#9;&#9;&#9;CollMarkComp=(CollMarkComp!= 0) ? CollMarkComp : 0;&#10;&#9;&#9;&#9;&#9;_strComp+=_strCollAll+"&#10;&#9;&lt;td class=xl34_finall &gt;" + CollMarkComp+ "&lt;/td&gt;";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (CollMarkCountIndi &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkIndi = CollMarkIndi / CollMarkCountIndi;&#10;&#9;&#9;&#9;&#9;CollMarkIndi = Real(StrRealFixed(CollMarkIndi, 2));&#10;&#9;&#9;&#9;} else if (CollMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkIndi = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;CollMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl34_finall &gt;" + CollMarkIndi + "&lt;/td&gt;";&#10;&#10;&#9;&#9;&#9;// средняя оценка экспертов&#10;&#9;&#9;&#9;ExpertMarkIndi = Real(0.0);&#10;&#9;&#9;&#9;ExpertMarkComp=Real(0.0);&#10;&#9;&#9;&#9;ExpertMarkCountIndi=0;&#10;&#9;&#9;&#9;ExpertMarkCountComp=0;&#10;&#9;&#9;&#9;for (_pa in PasExpert)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;if (_pa != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;Comp = OpenDoc(UrlFromDocID(_pa.id)).TopElem.competences.GetOptChildByKey(_comp.competence_id);&#10;&#9;&#9;&#9;&#9;&#9;_getMark=GetMarkFromCompetence(Comp, "mark");&#10;&#9;&#9;&#9;&#9;&#9;Indi = Comp.indicators.GetOptChildByKey(_indi.indicator_id);&#10;&#9;&#9;&#9;&#9;&#9;if (Comp != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_emark = (_getMark!=null) ? _getMark : GetMark(Comp, "indicators", OVERALL_MARK_FORMULA, "mark");&#9;&#9;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_emark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkComp += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_emark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkComp += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountComp++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strExpert+="&#10;&#9;&lt;td class=xl34_finall &gt;" + _emark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;if (Indi != undefined) {&#10;&#9;&#9;&#9;&#9;&#9;&#9;_emark = GetMarkFromCompetence(Indi, "mark");&#10;&#10;&#9;&#9;&#9;&#9;&#9;&#9;if(_emark == null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_emark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + _emark + "&lt;/td&gt;";&#10;&#9;&#9;&#9;&#9;&#9;&#9;if (_emark != null)&#10;&#9;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkIndi += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;} else {&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;_emark = 0;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkIndi += _emark;&#10;&#9;&#9;&#9;&#9;&#9;&#9;&#9;ExpertMarkCountIndi++;&#10;&#9;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;if (ExpertMarkCountComp &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkComp = ExpertMarkComp / ExpertMarkCountComp;&#10;&#9;&#9;&#9;&#9;ExpertMarkComp = Real(StrRealFixed(ExpertMarkComp, 2));&#10;&#9;&#9;&#9;} else if (ExpertMarkCountComp == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkCom = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkCom = "";&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;if (_strExpertAll==null)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;_strExpertAll=(_strExpert!= null) ? _strExpert : '';&#10;&#9;&#9;&#9;&#9;ExpertMarkComp=(ExpertMarkComp!= 0) ? ExpertMarkComp : 0;&#10;&#9;&#9;&#9;&#9;_strComp+=_strExpertAll+"&#10;&#9;&lt;td class=xl34_finall &gt;" + ExpertMarkComp+ "&lt;/td&gt;&#10;";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if (ExpertMarkCountIndi &gt; 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = ExpertMarkIndi / ExpertMarkCountIndi;&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = Real(StrRealFixed(ExpertMarkIndi, 2));&#10;&#9;&#9;&#9;} else if (ExpertMarkCountIndi == 0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = 0;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;ExpertMarkIndi = "";&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl34_finall &gt;" + ExpertMarkIndi + "&lt;/td&gt;&#10;";&#10;&#9;&#9;&#9;// плановая оценка индикатора&#10;&#9;&#9;&#9;PlanMarkIndi = GetMarkFromCompetence(_indi, "plan");&#9;&#9;&#9;&#10;&#9;&#9;&#9;PlanMarkIndi = (PlanMarkIndi!= null) ? PlanMarkIndi : 0;&#9;&#10;&#9;&#9;&#9;_strIndi[_rowIndi]+="&#10;&#9;&lt;td class=xl32_finall &gt;" + PlanMarkIndi + "&lt;/td&gt;&#10;&#9;&lt;/tr&gt;";&#10;&#9;&#9;_rowIndi++;&#10;&#9;&#9;}//for_indi&#10;&#9;&#9;// плановая оценка компетенции&#10;&#9;&#9;PlanMarkComp = GetMarkFromCompetence(_comp, "plan");&#9;&#9;&#9;&#10;&#9;&#9;PlanMarkComp = (PlanMarkComp!= null) ? PlanMarkComp : 0;&#10;&#9;&#9;_strComp +="&#10;&#9;&lt;td class=xl32_finall &gt;" + PlanMarkComp + "&lt;/td&gt;&#10;&#9;&lt;/tr&gt;";&#9;&#10;&#9;&#9;_str+=_strComp;&#10;&#9;&#9;for(i=0;i&lt;ArrayCount(_comp.indicators);i++)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;_str+=_strIndi[i];&#9;&#10;&#9;&#9;}&#10;&#10;&#9;&#9;}//for_comp&#10;&#9;&#9;_str+="&#10;&lt;/table&gt;&lt;/div&gt;";&#10;&#10;&#9;&#9;html_TEXT += _str;&#10;&#9;&#9;Session.excel_html += _str;&#10;&#9;} // for (_ass in AssessmentAppraises)&#10;&#10;%&gt;</html>
			<use_session_cache>false</use_session_cache>
			<cwt_type>default</cwt_type>
			<out_type>undefined</out_type>
			<access>
				<access_level>0</access_level>
			</access>
			<doc_info>
				<creation>
					<user_login>user1</user_login>
					<date>2010-06-02T23:03:49Z</date>
				</creation>
				<modification>
					<user_login>user1</user_login>
					<user_id>6148914691236517121</user_id>
					<date>2024-04-04T02:18:51Z</date>
				</modification>
			</doc_info>
			<is_std>false</is_std>
			<changed>false</changed>
			<is_enabled>true</is_enabled>
		</custom_web_template>
	</custom_web_templates>
</data>
